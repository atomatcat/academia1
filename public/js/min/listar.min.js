document.addEventListener("DOMContentLoaded",(event=>{document.getElementById("logoutBtn").addEventListener("click",(function(){fetch("alumno/logout",{}).then((function(response){window.location.href="/App/app/index.php/inicio/principal"})).catch((function(error){console.log(error)}))}))}));let grafica;function crearGrafico(datos){const $grafo=document.querySelector("#grafo");let datasetsPorAsignatura={};for(let dato of datos){if(!datasetsPorAsignatura[dato.id_asignatura]){datasetsPorAsignatura[dato.id_asignatura]={label:dato.id_asignatura,data:[],borderColor:"rgba(54,162,235,1)",backgroundColor:"crimson",borderWidth:1,cubicInterpolationMode:"monotone"}}datasetsPorAsignatura[dato.id_asignatura].data.push({x:dato.fecha.x,y:dato.calificacion.y})}let datasets=Object.values(datasetsPorAsignatura);grafica=new Chart($grafo,{type:"line",data:{datasets:datasets},options:{scales:{x:{type:"time",time:{parser:"DD.MM"}},y:{beginAtZero:true}}}})}function actualizarGrafica(grafica){fetch(`alumno/datos_grafico?dni=${dni_alumno}`).then((response=>response.json())).then((data=>{var datos=[];let i;for(i=0;i<data.length;i++){datos.push({asignatura:data[i]["id_asignatura"],calificacion:data[i]["calificacion"],fecha:data[i]["fecha"]})}let datasetsPorAsignatura={};let colores=["red","blue","orange","yellow","purple","green"];let colorPorAsignatura={};let colorIndex=0;for(let i=0;i<datos.length;i++){let dato=datos[i];if(!datasetsPorAsignatura[dato.asignatura]){if(!colorPorAsignatura[dato.asignatura]){colorPorAsignatura[dato.asignatura]={borderColor:colores[colorIndex%colores.length],backgroundColor:colores[(colorIndex+1)%colores.length]};colorIndex++}datasetsPorAsignatura[dato.asignatura]={label:dato.asignatura,data:[],borderColor:colorPorAsignatura[dato.asignatura].borderColor,backgroundColor:colorPorAsignatura[dato.asignatura].backgroundColor,borderWidth:1,cubicInterpolationMode:"monotone"}}datasetsPorAsignatura[dato.asignatura].data.push({x:dato.fecha,y:dato.calificacion})}grafica.data.datasets=Object.values(datasetsPorAsignatura);grafica.update()}))}document.addEventListener("DOMContentLoaded",(()=>{fetch(`alumno/datos_grafico?dni=${dni_alumno}`).then((response=>response.json())).then((data=>{var datos=[];let i;for(i=0;i<data.length;i++){datos.push({id_asignatura:data[i]["id_asignatura"],calificacion:{y:data[i]["calificacion"]},fecha:{x:data[i]["fecha"]}})}crearGrafico(datos);setInterval((()=>{actualizarGrafica(grafica)}),5e3)}))}));document.addEventListener("DOMContentLoaded",(event=>{fetch("alumno/probar?dni="+dni_alumno).then((response=>response.json())).then((data=>{document.getElementById("resultado").innerHTML="";var table=document.createElement("table");table.classList.add("table");var header=table.createTHead();header.classList.add("thead-dark");var row=header.insertRow(0);var cell1=row.insertCell(0);var cell2=row.insertCell(1);var cell3=row.insertCell(2);cell1.innerHTML="<b>DÃ­a</b>";cell2.innerHTML="<b>Hora</b>";cell3.innerHTML="<b>Asignatura</b>";var tbody=table.createTBody();for(var i=0;i<data.length;i++){var row=tbody.insertRow(i);var cell1=row.insertCell(0);var cell2=row.insertCell(1);var cell3=row.insertCell(2);cell1.innerHTML=data[i].dia;cell2.innerHTML=data[i].hora;cell3.innerHTML=data[i].nombre}document.getElementById("resultado").appendChild(table);document.getElementById("btn").addEventListener("click",(function(){const doc=new jsPDF;doc.text("Horrario de "+nom_alumno,10,10);doc.autoTable({html:"#resultado table"});doc.save("tabla3.pdf")}))})).catch((error=>console.error(error)))}));document.addEventListener("DOMContentLoaded",(event=>{const recursoBtn=document.getElementById("recursoBtn");const enlacesUl=document.getElementById("enlaces");enlacesUl.classList.add("list-group");let ruta_pdf;recursoBtn.addEventListener("click",(()=>{fetch(`alumno/get_recurso?dni=${dni_alumno}`).then((response=>response.json())).then((data=>{for(let i=0;i<data.length;i++){const recurso=data[i]["ruta_recurso"];const enlace=document.createElement("a");enlace.href="recursos/"+recurso;enlace.download=recurso;enlace.innerText=recurso;const enlaceLi=document.createElement("li");enlaceLi.classList.add("list-group-item");enlaceLi.appendChild(enlace);enlacesUl.appendChild(enlaceLi)}})).catch((error=>{console.error(error)}))}))}));