function validarCamposYaniadirAlumno(){const dni=document.querySelector(".dni").value;const nombre=document.querySelector(".nombre").value;const apellidos=document.querySelector(".apellidos").value;const email=document.querySelector(".email").value;if(!dni||!nombre||!apellidos||!email){alert("Todos los campos son obligatorios");return false}const regexLetras=/^[a-zA-Z]+$/;if(!regexLetras.test(nombre)||!regexLetras.test(apellidos)){alert("El nombre y los apellidos solo pueden contener letras");return false}const regexEmail=/^[a-zA-Z0-9]+@[a-zA-Z]+\.[a-zA-Z]{2,3}$/;if(!regexEmail.test(email)){alert("El email no es válido");return false}aniadirAlumno(dni,nombre,apellidos,email,centro,asignatura,hora);return true}function obtenerTipoUsuario(){const dni=document.querySelector(".dni").value;fetch(`admin/tipo_usuario?&dni=${dni}`).then((response=>response.text())).then((data=>{const tipoUsuario=JSON.parse(data).tipo;if(tipoUsuario===undefined){validarCamposYaniadirAlumno()}else{alert("El número de DNI:  "+dni+" pertenece a un "+tipoUsuario)}}))}function borrarAlumno(){const dni=document.querySelector(".dni").value;fetch(`admin/borrar_usuario?&dni=${dni}`).then((response=>response.json())).then((data=>{if(data.success){alert("El alumno ha sido borrado correctamente")}else{alert("Hubo un error al intentar borrar el alumno")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}function verificarDniYBorrar(){let campoDni=document.querySelector(".dni");let dni=campoDni.value;if(dni===""){alert("El campo DNI no puede estar vacío")}else{let table=document.querySelector(".table");let rows=table.rows;let dniExiste=false;for(let i=0;i<rows.length;i++){let rowDni=rows[i].cells[0].innerText;if(rowDni===dni){dniExiste=true;break}}if(!dniExiste){alert(" No existe ningún alumno con el DNI: "+dni)}else{borrarAlumno()}}}function limpiarCampos(){let inputs=document.querySelectorAll('input[type="text"]');for(let i=0;i<inputs.length;i++){inputs[i].value=""}}function modificarAlumno(){const dni=document.querySelector(".dni").value;const email=document.querySelector(".email").value;const centro=document.querySelector(".centro").value;if(!email&&!centro){alert("Para modificar introduce un valor en el campo email o centro")}else if(!centro){fetch(`admin/modEmailAlumno?dni=${dni}&email=${email}`).then((response=>{if(!response.ok){alert("Se ha producido un error de red ...");return}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar modificar email del alumno")}else if(data&&data.success){alert("El email del alumno ha sido modificado correctamente")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}else{fetch(`admin/modificarCentro?dni=${dni}&centro=${centro}`).then((response=>{if(!response.ok){alert("Se ha producido un error de red ... ");return}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar modificar centro del alumno")}else if(data&&data.success){alert("El centro del alumno ha sido modificado correctamente")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}}function verificarDniYmodificar(){let campoDni=document.querySelector(".dni");let dni=campoDni.value;if(dni===""){alert("El campo DNI no puede estar vacío")}else{let table=document.querySelector(".table");let rows=table.rows;let dniExiste=false;for(let i=0;i<rows.length;i++){let rowDni=rows[i].cells[0].innerText;if(rowDni===dni){dniExiste=true;break}}if(!dniExiste){alert(" No existe ningún alumno con el DNI: "+dni)}else{modificarAlumno()}}}function aniadirHorario(){const dni=document.querySelector(".dni").value;const asignatura=document.querySelector(".asignatura").value;const hora=document.querySelector(".hora").value;fetch(`admin/add_horario?dni=${dni}&asignatura=${asignatura}&hora=${hora}`).then((response=>{if(!response.ok){throw new Error("Se ha producido un error de red ...")}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar añadir las horas al alumno")}else if(data&&data.success){alert("La hora se ha añadido correctamente")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}function detectarBtn(boton){document.addEventListener("click",(function(event){let id=event.target.id;let res;if(id==="aniadir"){res="aniadir"}else if(id==="borrar"){res="borrar"}else if(id==="modificar"){res="modificar"}else if(id==="horario"){res="horario"}boton(res)}))}function aniadirAlumno(dni,nombre,apellidos,email,centro,asignatura,hora){fetch(`admin/add_alumno?dni=${dni}&nombre=${nombre}&apellidos=${apellidos}&email=${email}&centro=${centro}&asignatura=${asignatura}&hora=${hora}`).then((response=>response.json())).then((data=>{console.log(data);if(data.success){alert("El alumno ha sido añadir correctamente")}else{alert("Hubo un error al intentar añadir el alumno")}limpiarCampos()})).catch((error=>{console.error("Hay un error en el fetch:",error)}))}function camposTextProfesor(){const table=document.querySelector(".table");const filaTexto=document.createElement("tr");filaTexto.classList.add("ultima-fila");filaTexto.innerHTML=`\n        <td><input type="text" class="dni" placeholder="Dni"></td>\n        <td><input type="text" class="nombre" placeholder="Nombre"></td>\n        <td><input type="text" class="apellidos" placeholder="Apellidos"></td>\n        <td><input type="text" class="email" placeholder="Email"></td>\n        <td><input type="text" class="tipo" placeholder="Tipo"></td>\n       \n    `;table.appendChild(filaTexto)}function validarCamposYaniadirProf(){const dni=document.querySelector(".dni").value;const nombre=document.querySelector(".nombre").value;const apellidos=document.querySelector(".apellidos").value;const email=document.querySelector(".email").value;const tipo=document.querySelector(".tipo").value;if(!dni||!nombre||!apellidos||!email){alert("Todos los campos son obligatorios");return false}const regexLetras=/^[a-zA-Z]+$/;if(!regexLetras.test(nombre)||!regexLetras.test(apellidos)){alert("El nombre y los apellidos solo pueden contener letras");return false}const regexEmail=/^[a-zA-Z0-9]+@[a-zA-Z]+\.[a-zA-Z]{2,3}$/;if(!regexEmail.test(email)){alert("El email no es válido");return false}aniadirProfesor(dni,nombre,apellidos,email,tipo);return true}function aniadirProfesor(dni,nombre,apellidos,email,tipo){fetch(`admin/add_prof?dni=${dni}&nombre=${nombre}&apellidos=${apellidos}&email=${email}&tipo=${tipo}`).then((response=>response.json())).then((data=>{console.log(data);if(data.success){alert("El profesor ha sido añadido correctamente")}else{alert("Hubo un error al intentar añadir el profesor")}limpiarCampos()})).catch((error=>{console.error("Hay un error en el fetch:",error)}))}function modificarProfesor(){const dni=document.querySelector(".dni").value;const dniAnt=document.querySelector("#dniAnt").value;fetch(`admin/modificar_prof?dni=${dni}&dniAnt=${dniAnt}`).then((response=>{if(!response.ok){throw new Error("Se ha producido un error de red ...")}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar añadir las horas al alumno")}else if(data&&data.success){alert("La hora se ha añadido correctamente")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}function mostrarError(mensaje){document.getElementById("error-message-container").innerHTML='<p class="error-message">'+mensaje+"</p>"}function camposTextAlumno(){const table=document.querySelector(".table");const filaTexto=document.createElement("tr");filaTexto.classList.add("ultima-fila-alumno");filaTexto.innerHTML=`\n      \n          <td><input type="text"class="dni" placeholder="Dni"></td>\n          <td><input type="text" class="nombre" placeholder="Nombre"></td>\n          <td><input type="text" class="apellidos" placeholder="Apellidos"></td>\n          <td><input type="text" class="email" placeholder="Email"></td>\n          <td><input type="text" class="centro" placeholder="Centro"></td>\n          <td><input type="text" class="asignatura" placeholder="ID Asignatura"></td>\n          <td><input type="text" class="hora" placeholder="ID Hora"></td>\n          \n      `;table.appendChild(filaTexto)}let idSelect=null;let dniSelect=null;function actualizarValoresSelect(id,dniProf){idSelect=id;dniSelect=dniProf}function altaImparte(){if(idSelect!==null&&dniSelect!==null){fetch(`admin/alta_imparte?id=${idSelect}&dniProf=${dniSelect}`).then((response=>{if(!response.ok){throw new Error("Se ha producido un error de red ...")}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar dar de alta a la clase nueva")}else if(data&&data.success){alert("La clase nueva se ha añadido correctamente")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}}function reenarSelect(){fetch("admin/select_prof").then((response=>{if(!response.ok){throw new Error(`Error en la solicitud: ${response.status}`)}return response.text()})).then((data=>JSON.parse(data))).then((parsedData=>{const selectProf=document.querySelector("#prof-select");parsedData.forEach((horario=>{const option=document.createElement("option");option.value=horario.id;option.text=`${horario.dni_profesor} - ${horario.dia} - ${horario.hora}`;selectProf.appendChild(option)}));selectProf.addEventListener("change",(function(){const selectedOption=this.options[this.selectedIndex];const id=selectedOption.value;const dniProf=selectedOption.text.split(" - ")[0];console.log(`id: ${id}, dni prof: ${dniProf}`);actualizarValoresSelect(id,dniProf)}))}))}function camposTextClase(){const table1=document.querySelector(".table");const filaTexto=document.createElement("tr");filaTexto.innerHTML=`\n      \n          <td><input type="text" class="claseDia" placeholder="Dia"></td>\n          <td><input type="text" class="claseHora" placeholder="Hora"></td>\n          <td><input type="text" class="id_horario" placeholder="ID horario"></td>\n          <td><input type="text" class="dni" placeholder="Dni"></td>\n          <td><input type="text" class="claseTipo" placeholder="Asignatura"></td>\n          <td><input type="text" class="id_asignatura" placeholder="ID Asignatura"></td>\n          <td>\n            <select name="prof-select" id="prof-select" aria-label="Profesores">\n                <option value="">-- Elige una opción --</option>\n            </select>\n        </td>      \n          \n      `;table1.appendChild(filaTexto);reenarSelect()}function addHorarioClase(){const dniClase=document.querySelector(".dni").value;const diaClase=document.querySelector(".claseDia").value;const horaClase=document.querySelector(".claseHora").value;fetch(`admin/add_hora_clase?dniClase=${dniClase}&diaClase=${diaClase}&horaClase=${horaClase}`).then((response=>{if(!response.ok){throw new Error("Se ha producido un error de red ...")}return response.json()})).then((data=>{if(data&&!data.success){alert("Hubo un error al intentar añadir las horas al horario")}else if(data&&data.success){alert("La hora se ha añadido correctamente al horario")}limpiarCampos()})).catch((error=>console.error("Error:",error)))}function altaClase(){}window.addEventListener("load",(event=>{let elementoA=document.querySelectorAll("a");elementoA.forEach(((elemento,i)=>{elemento.addEventListener("click",(function(event){event.preventDefault();if(i==1){document.getElementById("aniadir").style.display="block";document.getElementById("dniAnt").style.display="block";document.getElementById("modificar").style.display="block";document.getElementById("borrar").style.display="none";document.getElementById("horario").style.display="none";fetch("admin/todos_profesores").then((response=>{if(!response.ok){throw new Error(`Error en la solicitud: ${response.status}`)}return response.text()})).then((data=>JSON.parse(data))).then((parsedData=>{const table=document.querySelector(".table");table.innerHTML="";const headerRow=document.createElement("tr");headerRow.innerHTML=`<th>Dni</th>\n                                                            <th>Nombre</th>\n                                                            <th>Apellidos</th>\n                                                            <th>Email</th>\n                                                            <th>Tipo</th>`;table.appendChild(headerRow);parsedData.forEach((profesor=>{const row=document.createElement("tr");row.innerHTML=`<td>${profesor.dni}</td>\n                                                       <td>${profesor.nombre}</td>\n                                                       <td>${profesor.apellidos}</td>\n                                                       <td>${profesor.email}</td>  \n                                                       <td>${profesor.tipo}</td>`;table.appendChild(row)}));camposTextProfesor();detectarBtn((function(resultado){if(resultado=="aniadir"){validarCamposYaniadirProf()}else if(resultado=="modificar"){modificarProfesor()}}))}))}else if(i==2){document.getElementById("aniadir").style.display="block";document.getElementById("dniAnt").style.display="none";document.getElementById("borrar").style.display="block";document.getElementById("modificar").style.display="block";document.getElementById("horario").style.display="block";fetch("admin/todos_alumnos").then((response=>{if(!response.ok){throw new Error(`Error en la solicitud: ${response.status}`)}return response.text()})).then((data=>JSON.parse(data))).then((parsedData=>{const table=document.querySelector(".table");table.innerHTML="";const row=document.createElement("tr");const headerRow=document.createElement("tr");headerRow.innerHTML=`<th colspan="5">Dni</th>\n                                                                              <th colspan="5" >Nombre</th>\n                                                                              <th colspan="5">Apellidos</th>\n                                                                              <th colspan="7">Email</th>\n                                                                              <th colspan="5">Centro</th>`;table.appendChild(headerRow);parsedData.forEach((alumno=>{const row=document.createElement("tr");row.innerHTML=`<td colspan="5">${alumno.dni}</td>\n                                                           <td colspan="5">${alumno.nombre}</td>\n                                                           <td colspan="5">${alumno.apellidos}</td>\n                                                           <td colspan="7">${alumno.email}</td>\n                                                           <td colspan="5">${alumno.centro}</td>`;table.appendChild(row)}));camposTextAlumno();detectarBtn((function(resultado){if(resultado=="aniadir"){obtenerTipoUsuario()}else if(resultado=="borrar"){let borrarBtn=document.querySelector("#borrar");borrarBtn.addEventListener("click",verificarDniYBorrar())}else if(resultado=="modificar"){verificarDniYmodificar()}else if(resultado=="horario"){let horarioBtn=document.querySelector("#horario");horarioBtn.addEventListener("click",aniadirHorario())}}))}))}else if(i==3){document.getElementById("borrar").style.display="block";document.getElementById("borrar").innerHTML="Añadir horas";document.getElementById("aniadir").style.display="block";document.getElementById("aniadir").innerHTML="Alta clase";document.getElementById("horario").style.display="none";document.getElementById("dniAnt").style.display="none";fetch("admin/horario_clases").then((response=>{if(!response.ok){throw new Error(`Error en la solicitud: ${response.status}`)}return response.text()})).then((data=>JSON.parse(data))).then((parsedData=>{const table=document.querySelector(".table");table.innerHTML="";const row=document.createElement("tr");const headerRow=document.createElement("tr");headerRow.innerHTML=`<th>Dia</th>\n                                                          <th>Hora</th>\n                                                          <th>ID Horario</th>\n                                                          <th>Profesor</th>\n                                                          <th>ID Profesor</th>\n                                                          <th>Asignatura</th>\n                                                          <th>ID Asignatura</th>\n                                                          <th>Nº Alumnos</th>`;table.appendChild(headerRow);parsedData.forEach((clase=>{const row=document.createElement("tr");const numAlumnos=mostrarLibre(clase.num_alumnos);row.innerHTML=`<td>${clase.dia}</td>\n                                                        <td>${clase.hora}</td>\n                                                        <td>${clase.id_horario}</td>\n                                                        <td>${clase.nombre}</td>\n                                                        <td>${clase.dni}</td>\n                                                        <td>${clase.tipo}</td>\n                                                        <td>${clase.id_asignatura}</td>\n                                                        ${numAlumnos}`;table.appendChild(row)}));camposTextClase()})).catch((error=>{console.error("Error:",error)}));detectarBtn((function(resultado){if(resultado=="aniadir"){console.log("Alta clase");let altaBtn=document.querySelector("#aniadir");altaBtn.addEventListener("click",altaImparte())}else if(resultado=="borrar"){let aniadirBtn=document.querySelector("#borrar");aniadirBtn.addEventListener("click",addHorarioClase())}}))}}))}))}));document.addEventListener("DOMContentLoaded",(function(){function logout(){document.getElementById("btn").addEventListener("click",(function(){fetch("admin/logout",{}).then((function(response){window.location.href="/App/app/index.php/inicio/principal"})).catch((function(error){console.log(error)}))}))}logout()}));